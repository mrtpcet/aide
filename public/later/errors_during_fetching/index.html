<!DOCTYPE html>
<html lang="fr" dir="ltr">

<head>
  <meta name="generator" content="Hugo 0.75.1" />
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Erreur durant la récupération des articles #  Pourquoi la récupération des articles échoue ? #  Il peut y avoir plusieurs raisons :
 problème de connexion internet ; problème au niveau du serveur hébergeant l&rsquo;article ; wallabag ne peut pas récupérer le contenu à cause de la structure du site web.  Si la récupération de l&rsquo;article échoue, il peut être utile d&rsquo;essayer une nouvelle fois de récupérer le contenu en cliquant dans la barre latérale sur le bouton Recharger le contenu.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="Erreur durant la récupération des articles #  Pourquoi la récupération des articles échoue ? #  Il peut y avoir plusieurs raisons :
 problème de connexion internet ; problème au niveau du serveur hébergeant l&rsquo;article ; wallabag ne peut pas récupérer le contenu à cause de la structure du site web.  Si la récupération de l&rsquo;article échoue, il peut être utile d&rsquo;essayer une nouvelle fois de récupérer le contenu en cliquant dans la barre latérale sur le bouton Recharger le contenu." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://aide.pcet.link/later/errors_during_fetching/" />

<title>Errors During Fetching | Aide | pcet.link</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.aac2058e2a004f987017efe7b83a659bdd010ff75e8e08d3820e795cb70b55db.css" integrity="sha256-qsIFjioAT5hwF&#43;/nuDplm90BD/dejgjTgg55XLcLVds=">
<script defer src="/fr.search.min.9db4034e30bae30b3982f7a6308af1f8787c163b5dcc7fb10e0a140e733ae9a7.js" integrity="sha256-nbQDTjC64ws5gvemMIrx&#43;Hh8FjtdzH&#43;xDgoUDnM66ac="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a href="/"><span>Aide | pcet.link</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Rechercher" aria-label="Rechercher" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-02cd3c80ba0bc044075eea69bfea6009" class="toggle"  />
    <label for="section-02cd3c80ba0bc044075eea69bfea6009" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a href="https://aide.pcet.link/discuter/" class="">Discuter (Mattermost)</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/exemple-d-utilisation/" class="">Exemple d&#39;utilisation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e1ee47f6712d8068819cb203d13373b3" class="toggle"  />
    <label for="section-e1ee47f6712d8068819cb203d13373b3" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a  class="">1. Premiers pas</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/se-connecter/" class="">Se connecter sur Discuter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/les-bases/" class="">Bases de la messagerie</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/configuration-des-notifications/" class="">Configuration des notifications</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/organisation-des-conversations/" class="">Organisation des conversations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/recherche/" class="">Recherche</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/creer-une-equipe/" class="">Créer une équipe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/premiers_pas/gestion-des-membres/" class="">Gestion des membres</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bbdff79f8d6c6b1ccf41ecc4cd743f96" class="toggle"  />
    <label for="section-bbdff79f8d6c6b1ccf41ecc4cd743f96" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a  class="">2. Messagerie</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/envoi-de-messages/" class="">Envoi de messages</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/mentionner-des-membres/" class="">Mentionner des membres</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/formater-le-texte/" class="">Formater le texte</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/joindre-des-fichiers/" class="">Joindre des fichiers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/executer-des-commandes/" class="">Exécuter des commandes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/messagerie/marquer-un-message/" class="">Marquer un message</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9b3dac0e7b1b189a92f49a82c14d57aa" class="toggle"  />
    <label for="section-9b3dac0e7b1b189a92f49a82c14d57aa" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a  class="">3. Paramètres</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/parametres/parametres-du-compte/" class="">Paramètres du compte</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/parametres/couleurs-du-theme/" class="">Couleurs du thème</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/parametres/parametres-equipe/" class="">Paramètres d&#39;équipe </a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/parametres/parametres-du-canal/" class="">Paramètres du canal</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/politique-de-confidentialite/" class="">Politique de confidentialité</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/conditions-d-utilisation/" class="">Conditions d&#39;utilisation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/discuter/nouvelle-adresse/" class="">Nouvelle adresse</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eec216b8249fa556d83cfceb7fdfed02" class="toggle"  />
    <label for="section-eec216b8249fa556d83cfceb7fdfed02" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a href="https://aide.pcet.link/date/" class="">Date (Framadate)</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/date/exemple-d-utilisation/" class="">Exemple d&#39;utilisation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/date/prise-en-main/" class="">Prise en main</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/date/fonctionnalites/" class="">Fonctionnalités</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/date/astuces/" class="">Astuces</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-04f6b8300f7c8212665e8bcc1068059a" class="toggle" checked />
    <label for="section-04f6b8300f7c8212665e8bcc1068059a" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a href="https://aide.pcet.link/later/" class="">Later (Wallabag)</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/exemple-d-utilisation/" class="">Exemple d&#39;utilisation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f76492b8f530d32ae021d15f2409fa7e" class="toggle"  />
    <label for="section-f76492b8f530d32ae021d15f2409fa7e" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a href="https://aide.pcet.link/later/articles/" class="">Les articles</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/sauvegarder/" class="">Sauvegarder un article</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/partager/" class="">Partager</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/tags/" class="">Les tags</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/filtres/" class="">Les filtres</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/annotations/" class="">Annotations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/sites-restreints/" class="">Sites restreints</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/articles/telecharger/" class="">Télécharger</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a8800e441c41262d4e4a99622d0e5a20" class="toggle"  />
    <label for="section-a8800e441c41262d4e4a99622d0e5a20" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a href="https://aide.pcet.link/later/configuration/" class="">Configuration</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/param%C3%A8tres/" class="">Paramètres</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/configuring_mobile/" class="">Configuring Mobile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/import/" class="">Import</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/password/" class="">Password</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/rss/" class="">Rss</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/tagging_rules/" class="">Tagging Rules</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/configuration/user_information/" class="">User Information</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/later/errors_during_fetching/" class=" active">Errors During Fetching</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d1c362974a150dc63adcb560aff5e564" class="toggle"  />
    <label for="section-d1c362974a150dc63adcb560aff5e564" class="flex justify-between">
      <span style="color:var(--gray-200);font-weight: bolder;"><a  class="">La lettre d&#39;Herminien</a></span>
      <span>▾</span>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="https://aide.pcet.link/la-lettre-d-herminien/politique-de-confidentialite/" class="">Politique de confidentialité</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="https://blog.pcet.link" target="_blank" rel="noopener">
        à propos
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Errors During Fetching</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="erreur-durant-la-récupération-des-articles">
  Erreur durant la récupération des articles
  <a class="anchor" href="#erreur-durant-la-r%c3%a9cup%c3%a9ration-des-articles">#</a>
</h1>
<h2 id="pourquoi-la-récupération-des-articles-échoue-">
  Pourquoi la récupération des articles échoue ?
  <a class="anchor" href="#pourquoi-la-r%c3%a9cup%c3%a9ration-des-articles-%c3%a9choue-">#</a>
</h2>
<p>Il peut y avoir plusieurs raisons :</p>
<ul>
<li>problème de connexion internet ;</li>
<li>problème au niveau du serveur hébergeant l&rsquo;article ;</li>
<li>wallabag ne peut pas récupérer le contenu à cause de la structure du site web.</li>
</ul>
<p>Si la récupération de l&rsquo;article échoue, il peut être utile d&rsquo;essayer une nouvelle fois de récupérer le contenu en cliquant dans la barre latérale sur le bouton <strong>Recharger le contenu</strong>. (Note : ce bouton est également très utile pour recharger un article en prenant en compte les modifications locales sur les <em>site configs</em>, voir ci-dessous.)</p>
<p><img src="../../img/user/refetch.png" alt="Réessayer de récupérer le contenu" /></p>
<h2 id="vérifier-les-logs-de-production-pour-les-messages-derreurs">
  Vérifier les logs de production pour les messages d&rsquo;erreurs
  <a class="anchor" href="#v%c3%a9rifier-les-logs-de-production-pour-les-messages-derreurs">#</a>
</h2>
<p>Par défaut, si le contenu d&rsquo;un site ne peut pas être correctement analysé à cause d&rsquo;une erreur dans la requête (une page inexistante, un temps de réponse trop long etc.), un message d&rsquo;erreur sera affiché dans le fichier <code>WALLABAG_DIR/var/logs/prod.log</code>.</p>
<p>Si vous voyez une ligne qui commence par <code>graby.ERROR</code> et qui correspond à votre période de test, c&rsquo;est que la requête a échoué à cause d&rsquo;une erreur. La nature de l&rsquo;erreur peut déjà donner quelques indications sur son origine :</p>
<ul>
<li>une erreur <code>404</code> indiquera que wallabag n&rsquo;a pas trouvé d&rsquo;article à l&rsquo;URL indiquée ;</li>
<li>une erreur <code>403</code> pourra indiquer que l&rsquo;URL renvoie vers une page à l&rsquo;accès interdit (ou que le site a mis en place des mesures pour empêcher la récupération de son contenu) ;</li>
<li>une erreur <code>500</code> pourra indiquer un problème sur le serveur distant ou de votre connexion internet ;</li>
<li>une erreur <code>504</code> ou <code>408</code> pourra indiquer que le serveur met trop longtemps à répondre etc.</li>
</ul>
<p>Merci d&rsquo;indiquer tout le passage correspondant à l&rsquo;erreur dans le ticket que vous ouvrirez sur <a href="https://github.com/wallabag/wallabag/issues">GitHub</a>.</p>
<h2 id="le-contenu-nest-pas-celui-attendu-ou-il-est-incomplet">
  Le contenu n&rsquo;est pas celui attendu ou il est incomplet
  <a class="anchor" href="#le-contenu-nest-pas-celui-attendu-ou-il-est-incomplet">#</a>
</h2>
<p>Wallabag utilise une conjonction de deux systèmes pour récupérer le contenu d&rsquo;un article :</p>
<ul>
<li>l&rsquo;utilisation de fichiers de configuration spécifiques à chaque domaine (souvent appelés <em>site config</em>, que vous pouvez trouver dans <code>vendor/j0k3r/graby-site-config/</code>) ;</li>
<li><a href="https://github.com/j0k3r/php-readability">php-readability</a>, qui analyse automatiquement le contenu d&rsquo;une page web pour déterminer ce qui a la plus de chance d&rsquo;être le contenu recherché.</li>
</ul>
<p>Ces systèmes ne sont pas infaillibles et il faudra parfois mâcher le travail à wallabag ! Afin de faciliter le travail des développeurs, il faut d&rsquo;abord vérifier l&rsquo;origine du problème en activant les logs détaillés de wallabag, puis éventuellement créer (ou mettre à jour) le fichier de configuration du site hébergeant l&rsquo;article voulu.</p>
<h3 id="vérifier-sur-f43me-si-le-problème-est-également-présent">
  Vérifier sur <strong>f43.me</strong> si le problème est également présent
  <a class="anchor" href="#v%c3%a9rifier-sur-f43me-si-le-probl%c3%a8me-est-%c3%a9galement-pr%c3%a9sent">#</a>
</h3>
<p>Une première vérification à faire est de tester l&rsquo;URL sur ce site : <a href="http://f43.me/feed/test"><a href="http://f43.me/feed/test">http://f43.me/feed/test</a></a>. Celui-ci utilise globalement la même manière de fonctionner que wallabag pour récupérer les articles. Si ça fonctionne sur <strong>f43.me</strong> et pas sur wallabag, c&rsquo;est qu&rsquo;il y a un souci avec wallabag qui casse le parser (difficile à résoudre : merci d&rsquo;ouvrir un <a href="https://github.com/wallabag/wallabag/issues/new">nouveau ticket à ce sujet sur GitHub</a>).</p>
<p>Si vous hébergez votre propre instance de wallabag, vous pouvez nous joindre des logs détaillés qui nous serons très utile pour déterminer plus justement l&rsquo;origine du problème (voir ci-après).</p>
<h3 id="activer-les-logs-auto-hébergement">
  Activer les logs (auto-hébergement)
  <a class="anchor" href="#activer-les-logs-auto-h%c3%a9bergement">#</a>
</h3>
<p>Si l&rsquo;étude des logs « basiques » n&rsquo;a pas permis d&rsquo;identifier une erreur criante et que vous n&rsquo;avez pas le contenu de l&rsquo;article, l&rsquo;erreur est peut-être ailleurs. Dans ce cas, vous devrez activer les logs sur votre instance wallabag pour nous aider à trouver ce qui ne va pas.</p>
<ul>
<li>dans le fichier <code>app/config/config_prod.yml</code>, modifiez la section <code>monolog</code> comme suit :</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">monolog</span>:
    <span style="color:#f92672">handlers</span>:
        <span style="color:#f92672">main</span>:
            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">fingers_crossed</span>
            <span style="color:#f92672">action_level</span>: <span style="color:#ae81ff">error</span>
            <span style="color:#f92672">handler</span>: <span style="color:#ae81ff">nested</span>
            <span style="color:#f92672">channels</span>: [<span style="color:#e6db74">&#39;!graby&#39;</span>]
        <span style="color:#f92672">nested</span>:
            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">stream</span>
            <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;%kernel.logs_dir%/%kernel.environment%.log&#34;</span>
            <span style="color:#f92672">level</span>: <span style="color:#ae81ff">debug</span>
        <span style="color:#f92672">graby</span>:
            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">stream</span>
            <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;%kernel.logs_dir%/graby.log&#34;</span>
            <span style="color:#f92672">level</span>: <span style="color:#ae81ff">info</span>
            <span style="color:#f92672">channels</span>: [<span style="color:#e6db74">&#39;graby&#39;</span>]
        <span style="color:#f92672">console</span>:
            <span style="color:#f92672">type</span>: <span style="color:#ae81ff">console</span>
</code></pre></div><ul>
<li>videz le cache avec la commande <code>rm -rf var/cache/*</code> ;</li>
<li>rechargez votre instance wallabag et rechargez le contenu qui pose souci.</li>
</ul>
<p>Vous aurez désormais dans le fichier <code>var/logs/graby.log</code> des détails sur les différentes étapes effectuées par graby (l&rsquo;analyseur de contenu de wallabag). Si vous ne réussissez pas à déterminer avec ces logs l&rsquo;origine du problème, copiez/collez le contenu du fichier <code>var/logs/graby.log</code> dans un nouveau <a href="https://github.com/wallabag/wallabag/issues/new">ticket d&rsquo;incident GitHub</a>.</p>
<p>{% hint style=&ldquo;tip&rdquo; %}Il est possible d&rsquo;obtenir des informations <strong>extrêmement</strong> détaillées sur les modifications effectuées par graby lors de la récupération, l&rsquo;analyse et le nettoyage du code d&rsquo;un article en passant <code>level: debug</code> au lieu de <code>level: info</code> dans la section <code>graby:</code> ci-dessus.</p>
<p>Cela peut être très pratique lors de la création de fichiers de configuration (<em>site config</em>, voir ci-dessous) ; il faut cependant être conscient que l&rsquo;activation du <code>level: debug</code> engendre le stockage du code HTML complet de l&rsquo;article à plusieurs étapes du traitement. Le fichier de log va donc grossir très rapidement ! :){% endhint %}</p>
<h3 id="création-ou-mise-à-jour-dun-fichier-de-configuration-_site-config_">
  Création ou mise à jour d&rsquo;un fichier de configuration (<em>site config</em>)
  <a class="anchor" href="#cr%c3%a9ation-ou-mise-%c3%a0-jour-dun-fichier-de-configuration-_site-config_">#</a>
</h3>
<p>Le plus souvent, les erreurs de récupération de contenu ne sont pas dues à une erreur du serveur distant mais se résument à des fichiers de configuration absents ou dépassés (par exemple, suite à une refonte du site hébergeant le contenu). On pourra ainsi avoir le titre de l&rsquo;article non renseigné, pas de corps d&rsquo;article, des éléments surnuméraires ou manquants etc.</p>
<p>Vous pouvez essayer de résoudre ce problème vous-même en créant ou modifiant un fichier de configuration (comme ça, nous restons concentrés pour améliorer wallabag au lieu d&rsquo;écrire ces fichiers de configuration :) ) ! De (très) nombreux exemples sont disponibles sur le dépôt <a href="https://github.com/fivefilters/ftr-site-config">fivefilters/ftr-site-config</a> qui est le projet principal pour stocker les fichiers de configuration.</p>
<h4 id="_site-config_-type">
  <em>Site config</em> type
  <a class="anchor" href="#_site-config_-type">#</a>
</h4>
<p>Pour un article hébergé à l&rsquo;adresse <code>https://www.unsitedinformation.com/xxx/mon-article.html</code>, wallabag cherchera le fichier de configuration <code>unsitedinformation.com.txt</code> dans le dossier <code>vendor/j0k3r/graby-site-config</code>. Un fichier de configuration classique pourra se présenter ainsi :</p>
<pre><code># Titre de l'article
title: [XPath]

# Corps de l'article
body: [XPath]

# Élément(s) à supprimer du rendu final
strip: [XPath]

# Une URL de test, par exemple l'article sur lequel vous vous basez pour écrire ce fichier
test_url: https://www.unsitedinformation.com/xxx/mon-article.html
</code></pre><p>Les <code>[XPath]</code> correspondent aux adresses des éléments d&rsquo;intérêt dans le code HTML de la page web ; les indiquer dans le fichier de configuration permet à wallabag d&rsquo;aller chercher directement le contenu voulu sans devoir déterminer qui est quoi.</p>
<p>Vous pouvez déterminer ces chemins <em>XPath</em> à l&rsquo;aide de <a href="http://siteconfig.fivefilters.org/">ce site web</a> : chargez la page de votre article en indiquant son URL, puis sélectionnez la ou les parties du contenu qui correspondent à ce que vous souhaitez garder, le <em>XPath</em> est indiqué en bas de page. Vous pouvez également regarder directement le code de la page (<code>Ctrl</code>+<code>U</code> et/ou <code>F12</code> sur la plupart des navigateurs modernes) et déterminer les <em>XPath</em> à l&rsquo;aide des règles décrites dans la partie suivante.</p>
<p>Il est possible d&rsquo;indiquer d&rsquo;autres éléments dans un fichier de configuration (date, auteur(s), suppressions généralisées etc.), nous vous conseillons la lecture de <a href="https://help.fivefilters.org/full-text-rss/site-patterns.html#pattern-format">cette documentation</a> pour connaître l&rsquo;étendue des possibles.</p>
<p>Enfin, il est possible de tester au fur et à mesure votre fichier de configuration, jusqu&rsquo;à obtenir le résultat souhaité :</p>
<ul>
<li>en enregistrant votre fichier de configuration dans <code>vendor/j0k3r/graby-site-config</code>, puis en rechargeant le contenu de l&rsquo;article comme expliqué plus haut ;</li>
<li>sur <a href="https://f43.me/feed/test"><em>f43.me</em></a>, en cliquant sur <em>Want to try a custom siteconfig?</em> et en copiant le contenu de votre configuration avant de cliquer sur <em>Test</em>. Notez que vous aurez alors des informations supplémentaires après récupération en cliquant sur l&rsquo;onglet <em>Debug</em>.</li>
</ul>
<p>Une fois que votre fichier de configuration vous convient, vous pouvez créer une <em>pull request</em> sur le dépôt rassemblant tous les fichiers de configuration : <a href="https://github.com/fivefilters/ftr-site-config">fivefilters/ftr-site-config</a>. (Note : même si vous ne maîtrisez pas <em>git</em>, il est possible de <a href="https://help.github.com/articles/editing-files-in-another-user-s-repository/">créer ou de modifier des fichiers sur ce dépôt directement depuis votre navigateur web</a>). En attendant que les ajouts sur ce dépôt soient acceptés puis répercutés dans wallabag, vous pouvez conserver ce fichier de configuration dans le répertoire <code>vendor/j0k3r/graby-site-config</code> de votre wallabag (ces modifications sont cependant supprimées quand vous mettez à jour wallabag).</p>
<h4 id="quelques-bases-de-xpath-10">
  Quelques bases de XPath 1.0
  <a class="anchor" href="#quelques-bases-de-xpath-10">#</a>
</h4>
<p><em>XPath</em> (pour <em>XML Path Language</em>) est une norme permettant de décrire précisément le chemin d&rsquo;accès à un élément dans un document <em>XML</em>, et <em>a fortiori</em> dans une page web. Ces chemins sont principalement déterminés par les relations parent/enfant(s) des balises HTML (<code>&lt;div&gt;&lt;/div&gt;</code>, <code>&lt;a&gt;&lt;/a&gt;</code>, <code>&lt;p&gt;&lt;/p&gt;</code>, <code>&lt;section&gt;&lt;/section&gt;</code> etc.) et leur(s) attribut(s) (<code>class</code>, <code>id</code>, <code>src</code>, <code>href</code> etc.). La norme est illisible, mais <a href="https://www.w3.org/TR/1999/REC-xpath-19991116/#path-abbrev">cette section</a> donne un bon résumé de ce qui est possible.</p>
<p>Quelques exemples étant cependant plus parlants, nous nous baserons sur le (faux) document suivant :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">html</span>&gt;
    &lt;<span style="color:#f92672">head</span>&gt;
        <span style="color:#75715e">&lt;!-- metadonnées de la page web --&gt;</span>
    &lt;/<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">body</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;header&#34;</span>&gt;
            &lt;<span style="color:#f92672">header</span>&gt;
                &lt;<span style="color:#f92672">h1</span>&gt;Le titre de mon site&lt;/<span style="color:#f92672">h1</span>&gt;
            &lt;/<span style="color:#f92672">header</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">itemprop</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;articleBody&#34;</span>&gt;
            &lt;<span style="color:#f92672">article</span>&gt;
                &lt;<span style="color:#f92672">h1</span>&gt;Le titre de mon article&lt;/<span style="color:#f92672">h1</span>&gt;
                &lt;<span style="color:#f92672">p</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;author&#34;</span>&gt;par Jean Dupont&lt;/<span style="color:#f92672">p</span>&gt;
                &lt;<span style="color:#f92672">section</span>&gt;
                    &lt;<span style="color:#f92672">p</span>&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&lt;/<span style="color:#f92672">p</span>&gt;

                    &lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">strong</span>&gt;Lire aussi : &lt;/<span style="color:#f92672">strong</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;http://...&#34;</span>&gt;Lien vers un autre article&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;

                    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ads spam&#34;</span>&gt;Une publicité.&lt;/<span style="color:#f92672">div</span>&gt;
                &lt;/<span style="color:#f92672">section</span>&gt;
                &lt;<span style="color:#f92672">section</span>&gt;
                    &lt;<span style="color:#f92672">p</span>&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.&lt;/<span style="color:#f92672">p</span>&gt;
                &lt;/<span style="color:#f92672">section</span>&gt;
            &lt;/<span style="color:#f92672">article</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;footer&#34;</span>&gt;
            &lt;<span style="color:#f92672">footer</span>&gt;
                <span style="color:#75715e">&lt;!-- plein de publicités --&gt;</span>
            &lt;/<span style="color:#f92672">footer</span>&gt;
        &lt;/<span style="color:#f92672">div</span>&gt;
    &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><h5 id="sélection-du-titre">
  Sélection du titre
  <a class="anchor" href="#s%c3%a9lection-du-titre">#</a>
</h5>
<p>Le titre du document est contenu dans le <em>header</em> de plus haut niveau, c&rsquo;est-à-dire <code>&lt;h1&gt;[...]&lt;/h1&gt;</code>. Son <em>XPath</em> complet est <code>/html/body/div[2]/article/h1</code> : partant de la racine <code>/</code>, il faut aller dans la balise <code>html</code>, puis <code>body</code>, puis la seconde <code>div</code> rencontrée, puis dans <code>article</code> pour enfin arriver au <code>h1</code>. (Notez que mon <code>header</code> contient également un <code>h1</code> correspondant au titre du site.) Cependant, ce chemin complet est beaucoup trop complexe dans le cas de pages avec beaucoup d&rsquo;éléments imbriqués ; il existe donc un certain nombre de raccourcis utiles.</p>
<p>Le premier est <code>//</code> qui permet de sauter un nombre indéfini de balises avant (ou entre) les éléments indiqués :</p>
<ul>
<li><code>//h1</code> sélectionnerait à la fois le titre du site et de l&rsquo;article ;</li>
<li><code>//div//h1</code> sélectionnerait également le titre du site et de l&rsquo;article (les balises <code>header</code> et <code>article</code> étant ici ignorées) ;</li>
<li><code>//article/h1</code> permet de sélectionner le(s) <code>h1</code> directement contenus dans <code>article</code>, donc le titre de l&rsquo;article !</li>
</ul>
<p>Enfin, il est recommandé lorsque cela est possible de s&rsquo;appuyer sur les attributs des balises. Il paraît en effet logique de différencier les <code>h1</code> par le fait que l&rsquo;un est contenu dans la <code>div</code> possédant <code>class=&quot;header&quot;</code> et l&rsquo;autre dans la <code>div</code> possédant <code>itemprop=&quot;ArticleBody</code>. Pour cela, on ajoutera au nom de la balise <code>[@class=&quot;header&quot;]</code> ou <code>[@itemprop=&quot;articleBody&quot;]</code> :</p>
<ul>
<li><code>//div[@class=&quot;header&quot;]//h1</code> sélectionnerait le titre du site ;</li>
<li><code>//div[@itemprop=&quot;articleBody&quot;]//h1</code> sélectionnerait le titre de l&rsquo;article.</li>
</ul>
<p><em>Note : dans ce cas très simple, comme les attributs sont différents, on pourrait mettre uniquement <code>//div[@itemprop]//h1</code> sans préciser la valeur de l&rsquo;attribut. Cela est cependant moins restrictif et a donc plus de chances de poser des problèmes dans un document complexe.</em></p>
<p>Le fichier de configuration de ce site pourra au final indiquer <code>title: //div[@itemprop=&quot;articleBody&quot;]//h1</code> ou <code>title: //article/h1</code>.</p>
<h5 id="sélection-du-corps-et-suppression-des-éléments-superflus">
  Sélection du corps et suppression des éléments superflus
  <a class="anchor" href="#s%c3%a9lection-du-corps-et-suppression-des-%c3%a9l%c3%a9ments-superflus">#</a>
</h5>
<p>La sélection du corps de l&rsquo;article est ici assez triviale, tout étant contenu dans la balise <code>article</code> et ses enfants. On pourra ainsi indiquer dans notre fichier de configuration <code>body: //article</code> ou <code>body: //div[@itemprop=&quot;articleBody&quot;]</code>.</p>
<p>Cependant, l&rsquo;article récupéré contiendra alors les publicités contenues dans <code>&lt;div class=&quot;ads spam&quot;&gt;[...]&lt;/div&gt;</code>, ainsi que des liens que l&rsquo;on peut vouloir supprimer (<em>Lire aussi : [&hellip;]</em>). Heureusement, les fichiers de configuration permettent d&rsquo;utiliser une instruction <code>strip: [XPath]</code> pour enlever les éléments superflus !</p>
<p><em>XPath</em> ne permet pas d&rsquo;identifier une valeur parmi d&rsquo;autres dans un attribut : les chemins <code>//div[@class=&quot;ads&quot;]</code> ou <code>//div[@class=&quot;spam&quot;]</code> n&rsquo;indiqueront pas celui du bloc contenant ici une publicité !
La fonction <code>contains()</code> permet de chercher une chaine de caractère dans une autre (ici dans la valeur de l&rsquo;attribut <code>class</code>) : <code>//div[contains(@class, &quot;ads&quot;)]</code> ou <code>//div[contains(@class, &quot;spam&quot;)]</code> réussiront à sélectionner le contenu souhaité.</p>
<p><strong>Cette solution avec <code>contains()</code> n&rsquo;est toutefois à utiliser que dans des cas très simples.</strong> En effet, ces chemins pourront également sélectionner des <code>div</code> dont la classe est <code>pads</code>, <code>mads</code>, <code>adsaaaaaaaa</code> etc. Pour sélectionner précisément une balise dont un attribut est composé d&rsquo;une liste, il faudra utiliser l&rsquo;instruction barbare suivante :</p>
<p><strong><code>//div[contains(concat(' ', normalize-space(@class), ' '), ' ads ')]</code></strong></p>
<p>Au final, le fichier de configuration pourra contenir indifféremment :</p>
<pre><code>strip: //div[contains(concat(' ', normalize-space(@class), ' '), ' ads ')]
strip: //div[contains(concat(' ', normalize-space(@class), ' '), ' spam ')]

# Mais cela fonctionne aussi (très restrictif) !
strip: //div[@class=&quot;ads spam&quot;]
</code></pre><p>Enfin, nous souhaitons supprimer les liens connexes de l&rsquo;article afin de ne pas perturber la lecture dans wallabag, et il faudra donc sélectionner le paragraphe suivant :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">strong</span>&gt;Lire aussi : &lt;/<span style="color:#f92672">strong</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;...&#34;</span>&gt;Lien vers un autre site&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;
</code></pre></div><p>Ici, il n&rsquo;est pas possible de sélectionner le paragraphe grâce à un attribut et on ne peut décemment pas supprimer toutes les balises <code>strong</code> ou <code>a</code> du document. <em>XPath</em> permet toutefois de préciser le ou les enfant(s) que doit avoir une balise pour être sélectionnée, avec la notation <code>//balise[enfant]</code>.</p>
<p><em>Note : ne pas confondre la notation <code>//balise[@attribut]</code> (p. ex. <code>//div[@class=&quot;...&quot;]</code>) et <code>//balise[enfant]</code> (p.ex. <code>//p[strong]</code>). De même, ne pas confondre <code>//p/strong</code> qui sélectionne la balise <code>strong</code> et son contenu avec <code>//p[strong]</code> qui sélectionne le(s) paragraphe(s) contenant au moins une balise <code>strong</code>.</em></p>
<p>Comme de multiples types de paragraphes peuvent contenir un lien <code>a</code> ou une balise <code>strong</code>, on pourra restreindre le chemin en utilisant l&rsquo;opérateur <code>and</code> : <code>//p[strong and a]</code> permettra ainsi de sélectionner seulement un paragraphe ayant les deux éléments. Pour cibler encore plus précisément ce paragraphe, on pourra aussi examiner le contenu d&rsquo;une balise avec <code>contains()</code>, pour finalement obtenir dans notre fichier de configuration :</p>
<p><code>strip: //p[contains(strong, 'Lire') and a]</code></p>
<h4 id="liens-utiles">
  Liens utiles
  <a class="anchor" href="#liens-utiles">#</a>
</h4>
<p>Si vous souhaitez plus d&rsquo;informations sur <em>XPath</em>, la norme <a href="https://www.w3.org/TR/1999/REC-xpath-19991116/#path-abbrev">contient un résumé assez clair de ce qui est faisable</a>. Le site <strong>devhints.io</strong> a également <a href="https://devhints.io/xpath">une anti-sèche très complète sur <em>XPath</em></a>.</p>
<p>Si vous voulez tester de manière dynamique si un <em>XPath</em> fonctionne pour sélectionner un ou plusieurs éléments d&rsquo;une page, vous pouvez également utiliser <a href="http://www.whitebeam.org/library/guide/TechNotes/xpathtestbed.rhtm">ce bac à sable</a> qui évalue des chemins sur un code HTML/XML que vous pouvez <em>uploader</em>.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












